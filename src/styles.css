@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Libre+Baskerville:wght@400;700&display=swap');

/* Base */
:root { font-family: 'Playfair Display', serif; color: #1f2023; background-color: #424242; 
  --cta-bg: #ffff80; /* main yellow */
  --cta-sep-bg: #fefde8; /* pale wedge near bookmark */
  --ink: #000000;
  --cta-tip: 22px; /* triangular tip width for CTA */
  /* How far the hero image bleeds under the gallery for a smoother transition */
  --hero-bleed: 220px;
  /* Shared shadows */
  --shadow-btn-hover: 0 3px 8px rgba(0,0,0,0.22), 0 14px 28px rgba(0,0,0,0.32), 0 0 0 1px rgba(0,0,0,0.06);
  --shadow-btn-active: 0 1px 2px rgba(0,0,0,0.18), 0 8px 18px rgba(0,0,0,0.26), 0 0 0 1px rgba(0,0,0,0.05);
}
/* Interaction resets (centralized) */
:where(button,[role="button"],.qbtn,.hero__cta,.hero__bookmark){-webkit-appearance:none;appearance:none}
:where(.qbtn,.hero__cta,.hero__bookmark),:where(.qbtn,.hero__cta,.hero__bookmark) *{-webkit-tap-highlight-color:transparent}
button:focus:not(:focus-visible),
.qbtn:focus:not(:focus-visible),
.hero__cta:focus:not(:focus-visible),
.hero__bookmark:focus:not(:focus-visible){outline:none}
button::-moz-focus-inner,.qbtn::-moz-focus-inner,.hero__cta::-moz-focus-inner,.hero__bookmark::-moz-focus-inner{border:0}
@media(hover:none) and (pointer:coarse){
  html,body{-webkit-tap-highlight-color:transparent}
  .qbtn,.hero__cta,.hero__bookmark,
  .qbtn *,.hero__cta *,.hero__bookmark *{outline:none!important;-webkit-tap-highlight-color:transparent}
  .qbtn,.hero__cta,.hero__bookmark{-webkit-user-select:none;user-select:none;-webkit-touch-callout:none;touch-action:manipulation}
}
/* Pseudo fullscreen: use computed inner height when Fullscreen API is blocked */
html.pseudo-fullscreen, body.pseudo-fullscreen { 
  height: var(--inner-h, 100dvh);
  min-height: var(--inner-h, 100dvh);
}
.pseudo-fullscreen .page { 
  min-height: var(--inner-h, 100dvh);
}
* { box-sizing: border-box; }
body { margin: 0; min-height: 100vh; background: #424242; color: #f5f5f5; }

/* Interaction resets (centralized) */
:where(button,[role="button"],.qbtn,.hero__cta,.hero__bookmark){-webkit-appearance:none;appearance:none}
:where(.qbtn,.hero__cta,.hero__bookmark),:where(.qbtn,.hero__cta,.hero__bookmark) *{-webkit-tap-highlight-color:transparent}
.qbtn:focus:not(:focus-visible),
.hero__cta:focus:not(:focus-visible),
.hero__bookmark:focus:not(:focus-visible),
button:focus:not(:focus-visible){outline:none}
button::-moz-focus-inner,.qbtn::-moz-focus-inner,.hero__cta::-moz-focus-inner,.hero__bookmark::-moz-focus-inner{border:0}
@media(hover:none) and (pointer:coarse){
  html,body{-webkit-tap-highlight-color:transparent}
  .qbtn,.hero__cta,.hero__bookmark,
  .qbtn *,.hero__cta *,.hero__bookmark *{outline:none!important;-webkit-tap-highlight-color:transparent}
  .qbtn,.hero__cta,.hero__bookmark{-webkit-user-select:none;user-select:none;-webkit-touch-callout:none;touch-action:manipulation}
}

/* Hide scrollbars everywhere while preserving scroll */
html, body { -ms-overflow-style: none; scrollbar-width: none; }
* { scrollbar-width: none; }
*::-webkit-scrollbar { width: 0 !important; height: 0 !important; }

/* Allow scrolling in fullscreen on desktop (remove forced overflow hidden) */

/* Page structure */
.page { position: relative; background: #424242; color: #f5f5f5; min-height: 100vh; padding: 0 0 80px; display: flex; flex-direction: column; width: 100%; }

/* Safe-area padding for notches */
.page {
  padding-left: max(0px, env(safe-area-inset-left));
  padding-right: max(0px, env(safe-area-inset-right));
}

/* Hero */
.hero {
  position: relative !important;
  top: auto !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  height: 50vh !important;
  min-height: 0 !important;
  background: none !important; /* image moved to ::before to allow transparency mask */
  margin-bottom: clamp(24px, 4vw, 56px) !important;
}

/* Background image with bottom transparency mask */
.hero::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: calc(var(--hero-bleed) * -1);
  /* Ensure the visible portion is always the center of the image
     even when the pseudo-element extends below the hero. We offset
     the vertical background position upward by half of the bleed. */
  background-image: url('https://static.wixstatic.com/media/b9ad46_c71b6b5da4f54f7583853c3744a28a79~mv2.webp');
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center calc(50% - (var(--hero-bleed) / 2));
  z-index: 1;              /* below .hero__fade (2) and content (3) */
  pointer-events: none;
  /* Even more progressive fade into the page background */
  -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 58%, rgba(0,0,0,0) 100%);
  mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 58%, rgba(0,0,0,0) 100%);
  /* optional: smoother GPU hint */
  will-change: mask-image;
}

/* Fade overlay (deduped) */
.hero__fade {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: calc(var(--hero-bleed) * -1);
  pointer-events: none;
  opacity: 1;
  z-index: 2 !important;
  /* Modern bottom blend into the page background (softer, longer) */
  background: linear-gradient(
    to bottom,
    rgba(66,66,66,0) 0%,
    rgba(66,66,66,0.08) 40%,
    rgba(66,66,66,0.20) 60%,
    rgba(66,66,66,0.35) 75%,
    rgba(66,66,66,0.60) 88%,
    #424242 100%
  ) !important;
}
.hero__content { position: relative !important; z-index: 3 !important; }

/* Content */
.hero__content {
  margin: 0 auto !important;
  width: min(92vw, 720px) !important;
  padding: clamp(24px, 5vw, 56px) 24px !important;
  display: flex !important; flex-direction: column !important; align-items: center !important; justify-content: center !important;
  text-align: center !important; gap: clamp(10px, 2.5vw, 22px) !important;
}

/* Title + eyebrow */
.hero__title {
  font-family: 'Playfair Display', serif;
  /* lock size behavior across devices using viewport scaling */
  font-size: clamp(64px, 10vw, 140px) !important;
  letter-spacing: 0.12em !important; text-transform: uppercase; line-height: 1.08;
  margin: 0 !important; max-width: 100%;
  /* Keep title on one line and prevent mid-word breaks */
  white-space: nowrap; word-break: normal; overflow-wrap: normal; hyphens: manual;
  text-shadow: 0 14px 32px rgba(0,0,0,0.35);
  color: #fefff4 !important; /* OSRASE */
}
.hero__eyebrow { white-space: nowrap;  font-size: clamp(0.9rem, 2vw, 1.2rem); letter-spacing: 0.24em; font-weight: 600; line-height: 1.2; }
.hero__content .hero__eyebrow { white-space: nowrap;  margin-bottom: 0; line-height: 1.05; }
.hero__eyebrow + .hero__title { margin-top: calc(-1 * clamp(12px, 3vw, 24px)); }
.hero__eyebrow-primary { color: #ffff80 !important; }   /* SOUND TALES */
.hero__eyebrow-secondary { color: #fefff4 !important; } /* PRODUCTION */
/* Subtle depth for eyebrow text */
.hero__eyebrow,
.hero__eyebrow * { text-shadow: 0 1px 0 rgba(0,0,0,0.16), 0 8px 18px rgba(0,0,0,0.25); }

/* Eyebrow (SOUND TALES PRODUCTION) — force Playfair Display */
.hero__eyebrow,
.hero__eyebrow * {
  font-family: 'Playfair Display', serif !important;
}

/* Meta badges */
.hero__meta {
  display: flex; align-items: center; flex-wrap: wrap;
  gap: clamp(8px, 2vw, 16px); margin-top: clamp(4px, 1vw, 12px);
}
.hero__tag {
  display: inline-flex; align-items: center; white-space: nowrap;
  padding: 8px 14px; font-size: 0.85rem; font-weight: 700; letter-spacing: 0.06em;
  color: #fefff4 !important; background: #424242 !important; border: 1px solid #424242 !important;
  border-radius: 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.22), 0 8px 18px rgba(0,0,0,0.28);
}
.hero__tag.hero__tag--age {
  font-family: 'Libre Baskerville','Baskerville',serif !important;
  font-size: 0.82rem !important;
}

/* Actions */
.hero__actions { display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 28px; }
.hero__cta {
  position: relative !important;
  display: inline-flex !important; align-items: center !important; justify-content: center !important;
  height: 52px !important; padding: 0 62px !important;
  background: var(--cta-bg) !important; color: var(--ink) !important; border: none !important; 
  /* Arrondir les côtés du bouton (style capsule) */
  border-radius: 26px !important;
  font-size: 1.05rem !important; font-weight: 800 !important; letter-spacing: 0.05em !important; text-transform: uppercase !important;
  /* Supprimer l’ancienne forme hexagonale */
  -webkit-clip-path: none !important;
          clip-path: none !important;
  box-shadow: 0 1px 2px rgba(0,0,0,0.18), 0 8px 18px rgba(0,0,0,0.26), 0 0 0 1px rgba(0,0,0,0.04);
  transition: transform 160ms ease, box-shadow 160ms ease, filter 160ms ease;
  will-change: transform;
}
/* highlight layer */
.hero__cta::after { content: ''; position: absolute; inset: 0; border-radius: inherit; pointer-events: none; background: linear-gradient(to bottom, rgba(255,255,255,0.22), rgba(255,255,255,0) 42%); mix-blend-mode: soft-light; }
/* Remove pseudo-elements to ensure single-shape CTA */

/* Wedge removed intentionally to avoid extra shape between buttons */
.hero__bookmark {
  position: relative !important;
  height: 52px !important; width: 52px !important; padding: 0 !important;
  display: flex !important; align-items: center !important; justify-content: center !important;
  background: var(--cta-sep-bg) !important; border: none !important; border-radius: 8px !important;
  box-shadow: 0 1px 2px rgba(0,0,0,0.18), 0 8px 18px rgba(0,0,0,0.26), 0 0 0 1px rgba(0,0,0,0.04);
  transition: transform 160ms ease, box-shadow 160ms ease, filter 160ms ease;
  will-change: transform;
}
.hero__bookmark-icon { width: 20px !important; height: 20px !important; color: #424242 !important; fill: #424242 !important; }
/* highlight layer */
.hero__bookmark::after { content: ''; position: absolute; inset: 0; border-radius: inherit; pointer-events: none; background: linear-gradient(to bottom, rgba(255,255,255,0.18), rgba(255,255,255,0) 45%); mix-blend-mode: soft-light; }

/* Compact state */
.page--scrolled .hero { height: 45vh !important; min-height: 260px !important; }
.page--scrolled .hero__content {
  position: absolute !important; top: 50% !important; left: 50% !important; transform: translate(-50%, -50%) !important;
  max-width: min(96vw, 640px) !important; gap: clamp(12px, 3vw, 24px) !important; padding: clamp(24px, 5vw, 48px) 24px !important;
}
.page--scrolled .hero__title { font-size: clamp(1.3rem, 2.3vw, 1.6rem) !important; margin: 0 !important; }
.page--scrolled .hero__cta { height: 52px !important; padding: 0 62px !important; font-size: 1.05rem !important; letter-spacing: 0.05em !important; }
.page--scrolled .hero__bookmark { width: 52px !important; height: 52px !important; }
.page--scrolled .hero__bookmark-icon { width: 20px !important; height: 20px !important; }

/* Cards + gallery */
.card {
  background: #424242; border-radius: 28px; padding: 24px 26px 32px;
  /* Ombres modernisées (plus douces, multi-couches) */
  box-shadow:
    0 1px 2px rgba(0,0,0,0.35),
    0 8px 18px rgba(0,0,0,0.35),
    0 0 0 1px rgba(255,255,128,0.08);
  display: flex; flex-direction: column; gap: 20px; color: #f5f5f5; cursor: pointer;
  transition: transform 220ms ease, box-shadow 220ms ease, filter 220ms ease;
  position: relative;
}
.card:hover { 
  transform: translateY(-4px) scale(1.01);
  box-shadow:
    0 4px 10px rgba(0,0,0,0.35),
    0 16px 36px rgba(0,0,0,0.45),
    0 0 0 1px rgba(255,255,128,0.16);
}
/* Card title: support up to ~40 characters gracefully (2 lines max) */
.card__label {
  color: #fefff4; font-family: 'Playfair Display', serif; text-align: center;
  font-size: 1.5rem; letter-spacing: 0.02em; line-height: 1.25; margin: 0 auto;
  max-width: 92%;
  display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 2; line-clamp: 2;
  overflow: hidden; text-overflow: ellipsis; word-break: break-word;
  /* reserve space to avoid layout shift when clamped */
  min-height: calc(1.25em * 2);
  text-wrap: balance;
}
/* Modernize the inner elements inside cards (labels, image, badge) */
.card__label {
  font-weight: 600;
  letter-spacing: 0.02em;
  text-shadow: 0 1px 1px rgba(0,0,0,0.5);
}
.card__media { position: relative; border-radius: 22px; overflow: visible; aspect-ratio: 16/9; width: 100%; flex: 1 0 auto; background-size: cover; background-position: center; background-repeat: no-repeat; margin-top: 34px; transition: transform 220ms ease; will-change: transform; }
.card__media::before, .card__media::after, .card__badge::before, .card__badge::after { content: none !important; display: none !important; } /* dedupe */
.card__overlay { position: absolute; inset: 0; background: linear-gradient(180deg, rgba(6,8,15,0.05) 0%, rgba(6,8,15,0.65) 100%); pointer-events: none; transition: opacity 220ms ease; }
.card:hover .card__media { transform: scale(1.02); }
.card:hover .card__overlay { opacity: 0.96; }
.card__badge {
  width: 72px; height: 72px; border-radius: 50%;
  background: #fefff4; color: #1f2023; font-weight: 700; font-size: 1.7rem;
  display: grid; place-items: center;
  border: 2px solid rgba(0,0,0,0.22);
  box-shadow: 0 6px 16px rgba(0,0,0,0.45), 0 0 0 3px rgba(254,255,244,0.7) inset;
  position: absolute; top: 0; left: 50%; transform: translate(-50%, -50%); z-index: 2;
  font-family: 'Libre Baskerville','Baskerville','Playfair Display',serif;
}
.card:hover .card__badge { box-shadow: 0 10px 22px rgba(0,0,0,0.5), 0 0 0 3px rgba(254,255,244,0.85) inset; }

/* Gallery (base: desktop/tablette paysage ? 3 colonnes, cartes plus grandes)
   Place gallery above the extended hero fade */
.gallery { position: relative; z-index: 10 !important; width: min(1220px, 94vw); margin: 0 auto; display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 34px; }
.gallery .card { padding: 22px 26px 28px; gap: 18px; }
.gallery .card__label { margin-top: 6px; font-size: 1.6rem; }
.gallery .card__media { margin-top: 28px; }
.gallery .card__badge { width: 50px; height: 50px; font-size: 1.24rem; border-width: 1.5px; }

/* Media queries (single set) */
@media (min-width: 1400px) {
  .gallery { width: min(1320px, 92vw); gap: 36px; }
  .gallery .card { padding: 28px 32px 36px; gap: 20px; }
  .gallery .card__media { margin-top: 32px; }
}

/* Quickbar (floating buttons on hub) */
.quickbar {
  position: fixed;
  right: max(12px, env(safe-area-inset-right));
  bottom: max(24px, env(safe-area-inset-bottom));
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  z-index: 10060;
  opacity: 0;
  pointer-events: none;
  transition: opacity 220ms ease;
}
.quickbar.is-on { opacity: 1; pointer-events: auto; }
.quickbar.is-off { opacity: 0; pointer-events: none; }
body[data-mode='reader'] .quickbar { display: none !important; }

.qbtn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 52px;
  height: 52px;
  min-width: 52px;
  border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.14);
  background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)) rgba(32,32,32,0.62);
  color: #fefff4;
  box-shadow: 0 1px 2px rgba(0,0,0,0.18), 0 8px 18px rgba(0,0,0,0.26);
  text-shadow: 0 1px 1px rgba(0,0,0,0.28);
  cursor: pointer;
  transition: transform 160ms ease, box-shadow 160ms ease, filter 160ms ease, opacity 220ms ease;
}
.qbtn.is-hidden { opacity: 0; pointer-events: none; }
.qbtn:focus-visible { outline: 2px solid #ffff80; outline-offset: 2px; }
.qbtn:hover { transform: translateY(-2px); box-shadow: var(--shadow-btn-hover); }
.qbtn:active, .qbtn[data-pressed="1"] { transform: translateY(0); box-shadow: var(--shadow-btn-active); }
.qbtn .qicon { display: inline-block; pointer-events: none; font-size: 22px; line-height: 1; }
.qicon--svg { width: 24px; height: 24px; display: block; }
.qbtn--fullscreen svg {
  width: 24px;
  height: 24px;
  stroke: currentColor;
}
.qbtn--fullscreen.is-active {
  background: linear-gradient(180deg, rgba(255,255,255,0.24), rgba(255,255,255,0.08));
  color: #111;
  border-color: rgba(255,255,255,0.4);
  text-shadow: none;
}

@media (max-width: 768px) {
  .qbtn { width: 52px; height: 52px; }
}

/* Bookmarks panel (hub) */
.bm-mask {
  position: fixed;
  inset: 0;
  /* Keep mask under quickbar so it never covers quickbar buttons */
  z-index: 10050;
  /* Do NOT dim page when bookmarks open */
  background: transparent;
}
.bm-panel {
  position: fixed;
  left: var(--bm-left, auto);
  top: var(--bm-top, auto);
  /* default transform and animated origin */
  --bm-transform: translate(-50%, 0);
  transform: var(--bm-transform);
  width: min(92vw, 360px);
  background: #1f2023;
  color: #fefff4;
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.12);
  overflow: hidden;
  z-index: 10055; /* above mask, below quickbar */
  animation: bm-in-grow 160ms ease-out both;
}
/* Side variants */
.bm-panel.bm--bottom { --bm-transform: translate(-50%, 0); transform-origin: 50% 0%; }
.bm-panel.bm--left { --bm-transform: translate(calc(-100% - 8px), -50%); right: auto; transform-origin: 100% 50%; }
.bm-panel.bm--right { --bm-transform: translate(0, -50%); transform-origin: 0% 50%; }
/* Connector arrow */
.bm-panel::before {
  content: '';
  position: absolute;
  width: 14px; height: 14px;
  background: #1f2023;
  box-shadow: -1px -1px 0 0 rgba(255,255,255,0.12);
  transform: rotate(45deg);
}
.bm-panel.bm--bottom::before { left: 50%; top: -7px; transform: translateX(-50%) rotate(45deg); }
.bm-panel.bm--left::before { right: -7px; top: 50%; transform: translateY(-50%) rotate(45deg); }
.bm-panel.bm--right::before { left: -7px; top: 50%; transform: translateY(-50%) rotate(45deg); }
.bm-list { max-height: 60vh; overflow: auto; }

/* Mobile phones portrait */
@media (max-width: 480px) and (orientation: portrait) {
  .bm-panel { width: min(96vw, 420px); border-radius: 14px; }
  .bm-panel.bm--left { width: min(86vw, 320px); }
  .bm-list { max-height: 56vh; }
}

/* Tablets portrait */
@media (min-width: 481px) and (max-width: 1024px) and (orientation: portrait) {
  .bm-panel { width: min(92vw, 420px); }
  .bm-panel.bm--left { width: min(80vw, 360px); }
  .bm-list { max-height: 60vh; }
}
.bm-head { display: flex; align-items: center; justify-content: space-between; padding: 12px 14px; border-bottom: 1px solid rgba(255,255,255,0.1); }
.bm-title { font-weight: 800; letter-spacing: .04em; }
.bm-close { all: unset; cursor: pointer; font-size: 20px; line-height: 1; padding: 6px 8px; }
.bm-list { display: flex; flex-direction: column; max-height: 60vh; overflow: auto; }
.bm-empty { padding: 14px; opacity: .8; }
.bm-item { all: unset; cursor: pointer; display: flex; align-items: center; justify-content: space-between; gap: 10px; padding: 12px 14px; }
.bm-item:hover { background: rgba(255,255,255,0.06); }
.bm-label { font-weight: 700; letter-spacing: .02em; }
.bm-badge { min-width: 28px; height: 28px; border-radius: 999px; background: #FEFFF4; color: #1f2023; font-weight: 800; display: inline-grid; place-items: center; }
@keyframes bm-in-grow { from { transform: var(--bm-transform) scale(0.96); opacity: 0; } to { transform: var(--bm-transform) scale(1); opacity: 1; } }

@media (max-width: 900px) {
  .hero__content {
    padding: clamp(24px, 5vw, 48px);
    max-width: 96vw;
    gap: clamp(10px, 2vw, 18px);
    align-items: center;
    text-align: center;
  }
}

@media (max-width: 768px) {
  .hero { padding: 32px 16px; }
  .hero__content { padding: 32px 20px; gap: 16px; }
  .hero__title { font-size: clamp(2.8rem, 10vw, 4rem); text-align: center; }
  /* Tablet portrait ? 2 colonnes pour agrandir les cartes */
  .gallery { width: min(980px, 94vw); grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 28px; }
}

@media (max-width: 480px) {
  .hero { padding: 24px 16px; height: 62vh !important; }
  .hero__content { padding: 28px 16px; gap: 14px; }
  .hero__title { font-size: clamp(56px, 18vw, 96px) !important; }
  .hero__meta { gap: 8px; }
  .hero__tag { padding: 6px 14px; font-size: 0.8rem; }
  /* Keep hero buttons identical on small screens */
  .hero__actions { gap: 10px; margin-top: 22px; flex-wrap: nowrap; }
  .hero__cta { height: 56px !important; padding: 0 48px !important; min-width: clamp(240px, 74vw, 520px); font-size: 1.05rem !important; }
  .hero__bookmark { width: 56px !important; height: 56px !important; }
  /* Mobile ? 1 colonne, cartes larges */
  .gallery { width: 94vw; gap: 32px; margin-top: 36px; grid-template-columns: 1fr; }
}

/* Force consistent centered layout across all devices */
.hero { justify-content: center !important; }
.hero__content {
  align-items: center !important;
  text-align: center !important;
  margin-left: auto !important;
  margin-right: auto !important;
  width: min(92vw, 720px) !important;
  left: auto !important; transform: none !important;
}

/* Keep same layout even for page--scrolled state */
.page--scrolled .hero { height: 50vh !important; }
.page--scrolled .hero__content {
  position: relative !important; top: auto !important; left: auto !important; transform: none !important;
  align-items: center !important; text-align: center !important; margin: 0 auto !important;
}

/* Skip link (visible on focus) */
.skip-link {
  position: absolute;
  top: 8px;
  left: 8px;
  z-index: 1000;
  padding: 10px 14px;
  background: #ffff80;
  color: #000;
  border-radius: 10px;
  text-decoration: none;
  transform: translateY(-120%);
  transition: transform 0.2s ease;
}
.skip-link:focus,
.skip-link:focus-visible {
  transform: translateY(0);
  outline: 3px solid #000;
  outline-offset: 2px;
}

/* Focus-visible outlines for interactive elements */
.hero__cta:focus-visible,
.hero__bookmark:focus-visible,
.card:focus-visible {
  outline: 3px solid #ffff80;
  outline-offset: 3px;
  border-radius: 12px;
}

/* Subtle hover/active feedback */
.hero__cta,
.hero__bookmark {
  transition: transform 160ms ease, box-shadow 160ms ease, filter 160ms ease;
}
.hero__cta:hover,
.hero__bookmark:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-btn-hover);
}
.hero__cta:active,
.hero__bookmark:active {
  transform: translateY(0);
  box-shadow: var(--shadow-btn-active);
}
@media (hover: none) {
  .card:hover .card__media { transform: none; }
  .card:hover .card__overlay { opacity: 1; }
  .hero__cta:hover,
  .hero__bookmark:hover { transform: none; box-shadow: none; }
}

/* Visual state when bookmarked */
.hero__bookmark.is-bookmarked,
.hero__bookmark[aria-pressed="true"] {
  background: #ffff80 !important;
  color: #000 !important;
}
.hero__bookmark.is-bookmarked .hero__bookmark-icon,
.hero__bookmark[aria-pressed="true"] .hero__bookmark-icon {
  color: #000 !important;
  fill: #000 !important;
}

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce) {
  * {
    animation: none !important;
    transition-duration: 0.01ms !important;
    transition-delay: 0ms !important;
  }
  .card:hover,
  .hero__cta:hover,
  .hero__bookmark:hover {
    transform: none !important;
    box-shadow: none !important;
  }
}
/* Tablet portrait adjustments (600px-1024px, portrait) */
@media (min-width: 600px) and (max-width: 1024px) and (orientation: portrait) {
  .hero { height: 50vh !important; }
  .hero__content { width: min(88vw, 760px) !important; gap: 18px; }
  .hero__title { font-size: clamp(72px, 10vw, 110px) !important; }
  .hero__actions { gap: 10px; }
  .hero__cta { height: 56px !important; padding: 0 72px !important; min-width: clamp(260px, 42vw, 420px); }
  .hero__bookmark { width: 56px !important; height: 56px !important; }
  /* Tablet portrait ? 2 colonnes pour cartes plus grandes */
  .gallery { width: min(980px, 94vw); grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 28px; }
  .gallery .card { padding: 22px 26px 28px; }
}

@media (min-width: 768px) and (orientation: landscape) {
  .hero { height: 50vh !important; justify-content: flex-start !important; }
  .hero__content {
    align-items: flex-start !important;
    text-align: left !important;
    margin-left: clamp(48px, 8vw, 120px) !important;
    margin-right: auto !important;
    width: min(560px, 46vw) !important;
    margin-top: clamp(20px, 6vh, 72px) !important;
  }
  .hero__title { font-size: clamp(64px, 8.5vw, 110px) !important; }
  .hero__actions { justify-content: flex-start; gap: 8px; margin-top: 18px; }
  .hero__cta { height: 52px !important; padding: 0 60px !important; }
  .hero__bookmark { width: 52px !important; height: 52px !important; }
  /* Tablette paysage / Desktop par défaut ? 3 colonnes, plus grands */
  .gallery { width: min(1220px, 94vw); grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 34px; }
}

/* Desktop (>= 1025px) */
@media (min-width: 1025px) {
  .hero { height: 48vh !important; justify-content: flex-start !important; }
  .hero__content {
    align-items: flex-start !important;
    text-align: left !important;
    margin-left: clamp(60px, 8vw, 140px) !important;
    margin-right: auto !important;
    width: min(600px, 44vw) !important;
  }
  .hero__title { font-size: clamp(72px, 7.8vw, 120px) !important; }
  .hero__actions { justify-content: flex-start; gap: 8px; margin-top: 20px; }
  .hero__cta { height: 52px !important; padding: 0 64px !important; }
  .hero__bookmark { width: 52px !important; height: 52px !important; }
  .gallery { width: min(1320px, 92vw); grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 36px; }
}

/* Floating actions bar (appears when hero actions are off-screen) */
.fab {
  position: fixed !important;
  left: 50%; bottom: max(16px, env(safe-area-inset-bottom));
  transform: translateX(-50%);
  display: flex; gap: 10px; align-items: center; flex-wrap: nowrap; justify-content: center;
  padding: 0; /* no surrounding background */
  background: transparent;
  box-shadow: none;
  border-radius: 0;
  z-index: 10000;
  /* smooth appear */
  opacity: 0;
  animation: fab-fade-in 360ms ease-out forwards;
  /* Improve reliability of fixed on mobile/WebViews */
  will-change: transform;
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
  pointer-events: auto;
  /* Keep inside viewport width and avoid overflow */
  max-width: calc(100vw - 32px - env(safe-area-inset-left) - env(safe-area-inset-right));
  width: max-content;
  min-width: 0;
}
.fab .hero__cta { height: 48px !important; padding: 0 28px !important; white-space: nowrap; }
.fab .hero__bookmark { width: 48px !important; height: 48px !important; }

@media (min-width: 768px) {
  .fab {
    left: auto; right: 24px; transform: none;
    bottom: max(24px, env(safe-area-inset-bottom));
  }
}

/* Strengthen fixed positioning behavior on iOS/WebViews */
@supports (-webkit-touch-callout: none) {
  .fab {
    position: fixed !important;
  }
}

/* Phone landscape: reduce hero size and avoid overlaps; make gallery 2 cols */
@media (max-width: 896px) and (orientation: landscape) {
  :root { --hero-bleed: 120px; }
  .hero { height: 42vh !important; }
  .hero__content { width: min(92vw, 640px) !important; gap: 12px; margin-top: clamp(16px, 6vh, 56px) !important; }
  .hero__title { font-size: clamp(40px, 9vw, 72px) !important; }
  .hero__actions { gap: 8px; margin-top: 12px; }
  .hero__cta { height: 48px !important; padding: 0 48px !important; }
  .hero__bookmark { width: 48px !important; height: 48px !important; }
  .gallery { width: 96vw; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 22px; margin-top: 20px; }
}

/* Mobile: center FAB and guarantee in-frame width */
@media (max-width: 768px) {
  .fab {
    left: 50%;
    transform: translateX(-50%);
    width: calc(100vw - 24px - env(safe-area-inset-left) - env(safe-area-inset-right));
    max-width: calc(100vw - 24px - env(safe-area-inset-left) - env(safe-area-inset-right));
    padding: 0 8px;
    box-sizing: border-box;
    gap: 8px;
  }
  .fab .hero__cta { flex: 1 1 auto; min-width: 0; max-width: 100%; }
  .fab .hero__bookmark { flex: 0 0 auto; }
}

/* Very short viewports: ensure FAB stays inside vertically */
@media (max-height: 480px) {
  .fab { bottom: max(8px, env(safe-area-inset-bottom)); }
  .fab .hero__cta { height: 44px !important; padding: 0 24px !important; }
  .fab .hero__bookmark { width: 44px !important; height: 44px !important; }
}

/* Tiny landscape heights: further reduce */
@media (orientation: landscape) and (max-height: 420px) {
  .fab { bottom: max(6px, env(safe-area-inset-bottom)); }
  .fab .hero__cta { height: 40px !important; padding: 0 20px !important; }
  .fab .hero__bookmark { width: 40px !important; height: 40px !important; }
}

@keyframes fab-fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Launch gate (fullscreen intro) */
.gate {
  position: fixed; inset: 0; z-index: 100000;
  background: #424242;
  display: grid; place-items: center;
  /* Ensure full dynamic viewport coverage to avoid bottom flash */
  width: 100vw; height: 100svh; height: 100dvh; height: 100lvh; min-height: 100lvh;
  /* Block any scroll/overscroll while gate is shown */
  overflow: hidden; overscroll-behavior: none; touch-action: none;
  /* Force hardware acceleration for better performance in in-app browsers */
  transform: translateZ(0); will-change: opacity;
  contain: layout paint;
  padding: 0;
}

/* Lock layout during gate to prevent any underlying shift */
html.gate-lock, body.gate-lock {
  position: fixed; inset: 0; overflow: hidden; width: 100%; height: 100dvh;
}
/* While locked, hide hub underlay to avoid any incidental paint */
body.gate-lock .page { visibility: hidden !important; }

/* Vignette respirante (halo radial très léger) */
/* Remove decorative vignette during gate to ensure perfectly uniform background */
.gate::before { content: none !important; }

/* In-app browser banner: suggest opening in system browser */
.iab-banner {
  position: fixed;
  top: max(10px, env(safe-area-inset-top));
  left: 50%;
  transform: translateX(-50%);
  z-index: 10050;
  display: flex;
  flex-direction: column;
  gap: 10px;
  align-items: center;
  justify-content: center;
  background: rgba(30, 30, 30, 0.75);
  -webkit-backdrop-filter: blur(6px);
  backdrop-filter: blur(6px);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 12px;
  padding: 12px;
  max-width: calc(100vw - 24px - env(safe-area-inset-left) - env(safe-area-inset-right));
}
.iab-text {
  color: #fefff4;
  font-family: 'Playfair Display', serif;
  font-size: clamp(14px, 3.4vw, 16px);
  text-align: center;
  letter-spacing: 0.02em;
  line-height: 1.35;
  margin: 0;
}
.iab-btn {
  all: unset;
  cursor: pointer;
  background: var(--cta-bg);
  color: var(--ink);
  font-family: 'Playfair Display', serif;
  font-weight: 700;
  letter-spacing: 0.06em;
  padding: 10px 16px;
  border-radius: 12px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.18), 0 8px 18px rgba(0,0,0,0.26), 0 0 0 1px rgba(0,0,0,0.04);
}
.iab-btn--ghost {
  background: transparent;
  color: #fefff4;
  border: 1px solid rgba(255,255,255,0.28);
}
.iab-banner--compact {
  position: sticky;
  top: 0;
  left: 0; right: 0;
  transform: none;
  margin: 6px auto;
  background: rgba(30,30,30,0.7);
  padding: 6px 10px;
  gap: 0;
}
.iab-banner--compact .iab-btn { padding: 6px 10px; font-size: 0.92rem; }
.iab-actions { display: flex; gap: 10px; }
@media (max-width: 420px) {
  .iab-actions { flex-direction: column; width: 100%; }
  .iab-actions .iab-btn { text-align: center; }
}
@media (min-width: 769px) {
  .iab-banner { display: none; }
}

/* Make the interactive layer fully cover with the same solid background */
.gate__hit {
  all: unset;
  cursor: pointer;
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  background: #424242; /* same as .gate background */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: clamp(12px, 4vh, 28px);
  /* keep content clear of notches and home indicators; make left/right symmetric so visual center stays true */
  padding-top:    max(16px, env(safe-area-inset-top));
  padding-bottom: max(20px, env(safe-area-inset-bottom));
  padding-left:   max(16px, max(env(safe-area-inset-left),  env(safe-area-inset-right)));
  padding-right:  max(16px, max(env(safe-area-inset-left),  env(safe-area-inset-right)));
  text-align: center;
  /* compensate asymmetric safe-area insets (e.g., landscape notch) to keep true viewport center */
  transform: translateX(calc((env(safe-area-inset-right) - env(safe-area-inset-left)) / 2));
  will-change: transform;
  /* Enhanced touch handling for in-app browsers */
  -webkit-tap-highlight-color: rgba(255, 255, 255, 0.1);
}
.gate__msg {
  position: static;
  left: auto; top: auto; transform: none;
  font-family: 'Playfair Display', serif; text-align: center; max-width: min(90vw, 640px);
  font-size: clamp(18px, 5vw, 32px); line-height: 1.25; letter-spacing: 0.04em;
  color: #fefff4; opacity: 1; transition: opacity .6s ease;
  padding: 0 12px;
  margin: 0 auto;
}
.gate__logo {
  position: static;
  left: auto; top: auto; transform: scale(0.975);
  display: block; margin: 0 auto; height: auto; opacity: 0; /* start hidden for fade-in */
  width: clamp(140px, min(52vw, 36vh), 360px); /* proportionnel à l'écran, borne min/max */
  max-width: min(380px, calc(100vw - 48px));
  max-height: min(44vh, 44dvh);
  transition: opacity 2000ms cubic-bezier(0.16,1,0.3,1), filter 2000ms cubic-bezier(0.16,1,0.3,1);
  will-change: opacity, transform, filter;
  filter: drop-shadow(0 10px 30px rgba(0,0,0,0.6)) blur(0.6px);

  user-select: none; -webkit-user-select: none; pointer-events: none; -webkit-user-drag: none;
}

/* Bookmark (signet) button on chapter cards */
.card__fav {
  position: absolute; top: 10px; right: 10px;
  width: 36px; height: 36px; border-radius: 18px;
  display: inline-flex; align-items: center; justify-content: center;
  background: rgba(255,255,255,0.08); color: #fefff4; border: 1px solid rgba(255,255,255,0.2);
  box-shadow: 0 2px 10px rgba(0,0,0,0.35);
}
.card__fav.is-on { background: #ffff80; color: #1f2023; border-color: #1f2023; font-weight: 800; }
.card__fav:focus-visible { outline: 2px solid #ffff80; outline-offset: 2px; }

/* Reader header bookmark button */
.reader__fav {
  all: unset; cursor: pointer;
  display: inline-grid; place-items: center;
  width: 28px; height: 28px; border-radius: 14px;
  margin-right: 8px;
  background: rgba(255,255,255,0.12); color: #fefff4; border: 1px solid rgba(255,255,255,0.2);
}
.reader__fav.is-on { background: #ffff80; color: #1f2023; border-color: #1f2023; font-weight: 800; }
.reader__fav:focus-visible { outline: 2px solid #ffff80; outline-offset: 2px; }

/* Very small height (landscape phones): reduce sizes a bit */
@media (max-height: 560px) {
  .gate__hit { gap: clamp(8px, 3vh, 18px); }
  .gate__msg { font-size: clamp(16px, 4vw, 24px); }
  .gate__logo { max-height: 32vh; width: clamp(120px, min(42vw, 28vh), 300px); }
}
.gate__logo svg { display:block; width:100%; height:auto; color: inherit; }
.gate__logo [fill]:not([fill="none"]) { fill: currentColor; }
.gate__logo [stroke]:not([stroke="none"]) { stroke: currentColor; }
.gate.is-starting .gate__msg { opacity: 0; transform: none; }
.gate.is-starting .gate__logo { opacity: 1; }
.gate.is-finishing .gate__msg, .gate.is-finishing .gate__logo { opacity: 0; }
.gate.is-finishing { opacity: 0; transition: opacity 360ms ease; }
.gate.is-logo .gate__msg { display: none !important; }
.gate.is-logo .gate__logo { opacity: 1 !important; filter: drop-shadow(0 10px 30px rgba(0,0,0,0.6)) blur(0); animation: gate-zoom 7000ms cubic-bezier(0.16,1,0.3,1) forwards; transform-origin: 50% 50%; }
@keyframes gate-zoom {
  0% { transform: scale(0.98); }
  100% { transform: scale(1.02); }
}

/* =============================
   Gate Centering Overrides (final)
   ============================= */
.gate__hit { padding: 0 !important; transform: none !important; }
.gate__center {
  position: absolute; left: 50%; top: 0; bottom: 0; transform: translateX(-50%);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  gap: clamp(12px, 4vh, 28px);
  padding-top: max(16px, env(safe-area-inset-top));
  padding-bottom: max(20px, env(safe-area-inset-bottom));
  padding-left:   max(16px, max(env(safe-area-inset-left),  env(safe-area-inset-right)));
  padding-right:  max(16px, max(env(safe-area-inset-left),  env(safe-area-inset-right)));
  width: 100%; text-align: center;
}
.gate__msg {
  position: static !important; left: auto !important; top: auto !important; transform: none !important;
  margin-left: auto !important; margin-right: auto !important;
  max-width: min(90vw, 640px) !important;
}
.gate__logo {
  position: static !important; left: auto !important; top: auto !important; transform: none !important;
  display: block !important; margin-left: auto !important; margin-right: auto !important;
  transform-origin: 50% 50% !important;
  width: clamp(140px, min(52vw, 36vh), 360px) !important;
  max-width: min(380px, calc(100vw - 48px)) !important;
  max-height: min(44vh, 44dvh) !important;
}
/* When inline SVG is used */
.gate__logo svg { display:block; width:100%; height:auto; color: inherit; }
.gate__logo [fill]:not([fill="none"]) { fill: currentColor; }
.gate__logo [stroke]:not([stroke="none"]) { stroke: currentColor; }
.gate.is-starting .gate__msg { opacity: 0; transform: none; }
.gate.is-starting .gate__logo { opacity: 1; }
.gate.is-finishing .gate__msg, .gate.is-finishing .gate__logo { opacity: 0; }
.gate.is-finishing { opacity: 0; transition: opacity 360ms ease; }
/* Instant logo state: no fade/crossfade, message hidden */
.gate.is-logo .gate__msg { display: none !important; }
.gate.is-logo .gate__logo { opacity: 1 !important; filter: drop-shadow(0 10px 30px rgba(0,0,0,0.6)) blur(0); animation: gate-zoom 7000ms cubic-bezier(0.16,1,0.3,1) forwards; transform-origin: 50% 50%; }
@keyframes gate-zoom {
  0% { transform: scale(0.98); }
  100% { transform: scale(1.02); }
}

/* When fading out, let scroll/pan pass through immediately */
.gate.is-finishing { pointer-events: none; }

/* Media queries adjustments for gate logo */
/* logo sizing already proportional; media blocks no longer required *//* Better mobile scroll prevention with special in-app browser handling */
.no-scroll { 
  overflow: hidden !important; 
  height: 100vh; 
  height: 100dvh; /* Dynamic viewport height for better mobile support */
  /* More gentle approach for in-app browsers */
  position: relative;
  width: 100%;
  /* Prevent scroll chaining but allow some flexibility */
  overscroll-behavior: contain;
}

/* Only apply aggressive scroll prevention on standard browsers */
@media (min-width: 769px) {
  .no-scroll {
    position: fixed;
    -webkit-overflow-scrolling: auto;
    overscroll-behavior: none;
  }
}

/* Mobile-specific improvements with enhanced in-app browser support */
@media (max-width: 768px) {
  .gate {
    position: fixed;
    /* Better touch handling on mobile */
    -webkit-overflow-scrolling: touch;
    /* Less aggressive overscroll for in-app browsers */
    overscroll-behavior: auto;
    /* Enhanced performance for in-app browsers */
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
  }
  
  .gate__hit {
    /* Improve touch target */
    min-height: 44px;
    /* Prevent text selection on mobile */
    -webkit-user-select: none;
    user-select: none;
    /* Better touch feedback for in-app browsers */
    -webkit-tap-highlight-color: rgba(255, 255, 255, 0.1);
    /* Allow scroll gestures to pass through when appropriate */
    touch-action: pan-y;
    /* Enhanced interaction area for in-app browsers */
    padding: 20px;
  }
  
  /* Ensure mobile viewport works well in all contexts */
  .page {
    min-height: 100vh;
    min-height: -webkit-fill-available;
    min-height: 100dvh;
    /* Allow scroll in embedded contexts */
    overscroll-behavior: auto;
  }

  /* Less aggressive fixes for in-app browsers */
  body {
    /* Allow natural scrolling in in-app browsers */
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: auto;
  }

  /* Minimal intervention for WebView compatibility */
  html {
    overflow-x: hidden;
    -webkit-text-size-adjust: 100%;
  }
  
  /* Special handling when no-scroll is active on mobile */
  body.no-scroll {
    /* Gentler scroll prevention for mobile/in-app */
    overflow: hidden;
    position: relative;
    height: 100vh;
    /* Don't use fixed positioning on mobile */
  }
}

/* Enhanced adjustments for WebView contexts */
@supports (-webkit-touch-callout: none) {
  .gate {
    /* iOS WebView specific fixes */
    -webkit-overflow-scrolling: touch;
    /* Better performance in WebViews */
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
  }
  
  .gate__hit {
    /* Enhanced touch response in WebViews */
    -webkit-tap-highlight-color: rgba(255, 255, 255, 0.05);
    /* Better interaction handling but allow scroll */
    -webkit-touch-callout: none;
    touch-action: manipulation;
  }
  
  .no-scroll {
    /* Less aggressive scroll prevention on iOS WebView */
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: auto;
    /* Don't use fixed positioning in WebViews */
    position: relative !important;
  }
}

/* Special handling for known in-app browsers */
@media screen and (-webkit-min-device-pixel-ratio: 0) {
  /* Detect WebKit browsers (includes most in-app browsers) */
  .no-scroll {
    /* Minimal scroll intervention */
    overflow-y: auto;
    position: relative;
    /* Allow momentum scrolling */
    -webkit-overflow-scrolling: touch;
  }
  
  .gate {
    /* Ensure gate works without breaking scroll */
    overscroll-behavior: auto;
  }
}

/* Force-mobile layout override after exiting fullscreen */
body.force-mobile .gallery { grid-template-columns: 1fr !important; width: 94vw !important; gap: 32px !important; }
body.force-mobile .hero { padding: 24px 16px !important; height: 62vh !important; justify-content: center !important; }

/* Reader splash (transition from hub to reader) */
.reader-splash {
  position: fixed; inset: 0; z-index: 2000;
  display: grid; place-items: center;
  padding: max(16px, env(safe-area-inset-top)) max(16px, env(safe-area-inset-right)) max(24px, env(safe-area-inset-bottom)) max(16px, env(safe-area-inset-left));
  color: #1f2023;
  animation: splash-enter 880ms ease-out both;
}
.reader-splash__card { width: min(560px, 68vw); margin-left: auto; margin-right: auto; }
.reader-splash__img { width: 100%; aspect-ratio: 16/9; border-radius: 16px; display: block; box-shadow: 0 10px 30px rgba(0,0,0,0.25); }
.reader-splash__line { margin-top: clamp(18px, 3.6vw, 28px); display: flex; align-items: baseline; gap: 12px; }
.reader-splash__badge { display: inline-grid; place-items: center; width: 22px; height: 22px; border-radius: 50%; background: #1f2023; color: #FEFFF4; font-weight: 700; font-size: 0.9rem; }
.reader-splash__label { display: none; }
.reader-splash__title { font-family: 'Playfair Display', serif; font-weight: 700; letter-spacing: 0.02em; opacity: 0; transform: translateY(6px); }

.simple .reader-splash__img { opacity: 0; animation: fade-in 700ms ease-out 100ms forwards; }
.simple .reader-splash__badge, .simple .reader-splash__title { opacity: 0; transform: translateY(6px); animation: fade-in-up 700ms ease-out 250ms forwards; }
.phase-exit { animation: splash-exit 500ms cubic-bezier(.4,0,.6,1) both; }

@keyframes splash-enter { from { opacity: 0; transform: scale(0.96); } to { opacity: 1; transform: scale(1); } }
@keyframes chapter-wipe { from { transform: translateX(0%); } to { transform: translateX(-102%); } }
@keyframes title-in { from { opacity: 0; transform: translateY(6px);} to { opacity: 1; transform: translateY(0);} }
@keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
@keyframes fade-in-up { from { opacity: 0; transform: translateY(6px);} to { opacity: 1; transform: translateY(0);} }
@keyframes splash-exit { from { opacity: 1; transform: translateY(0);} to { opacity: 0; transform: translateY(-12px);} }

@media (prefers-reduced-motion: reduce) {
  .reader-splash { animation-duration: 480ms; }
  .phase-wipe .reader-splash__label::after { animation-duration: 480ms; }
  .phase-title .reader-splash__title, .phase-wait .reader-splash__title { animation-duration: 480ms; }
  .phase-exit { animation-duration: 640ms; }
}

/* Reader base */
.reader {
  position: fixed;
  inset: 0;
  display: flex;
  flex-direction: column;
  background: var(--reader-bg, #fefff4);
  color: var(--reader-ink, #1f2023);
  --reader-bg-light: #fefff4;
  --reader-bg-dark: #101013;
  --reader-ink-light: #1f2023;
  --reader-ink-dark: #f5f5f5;
  --reader-accent: #ffff80;
  --reader-muted: rgba(31,32,35,0.65);
  --reader-surface: rgba(255,255,245,0.88);
  --reader-border: rgba(17,17,17,0.1);
  --reader-panel-bg: rgba(250,250,245,0.9);
  --reader-rail-track: linear-gradient(180deg, rgba(0,0,0,0.12) 0%, rgba(0,0,0,0.34) 100%);
  --reader-rail-fill: #ffff80;
  --reader-voice-fill: #b3e5fc;
  --reader-shadow: 0 20px 40px rgba(20,20,24,0.28);
  --reader-transition: 220ms cubic-bezier(0.16,1,0.3,1);
  --reader-panel-radius: 28px;
  --reader-overlay-spacing: clamp(12px, 5vw, 24px);
  --reader-overlay-gap: clamp(12px, 4vw, 20px);
  --reader-bg: var(--reader-bg-light);
  --reader-ink: var(--reader-ink-light);
  transition: background-color var(--reader-transition), color var(--reader-transition);
}
.reader[data-theme='dark'] {
  --reader-bg: var(--reader-bg-dark);
  --reader-ink: var(--reader-ink-dark);
  --reader-muted: rgba(235,235,245,0.72);
  --reader-surface: rgba(18,18,25,0.82);
  --reader-border: rgba(255,255,255,0.16);
  --reader-panel-bg: rgba(15,15,20,0.82);
  --reader-rail-track: linear-gradient(180deg, rgba(255,255,255,0.12) 0%, rgba(0,0,0,0.55) 100%);
  --reader-rail-fill: #ffe870;
  --reader-voice-fill: #7fd3ff;
  --reader-shadow: 0 26px 48px rgba(0,0,0,0.55);
}
.reader[data-theme='dark'] .para { color: var(--reader-ink); }

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

.reader__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px clamp(16px, 5vw, 28px);
  gap: 12px;
}
.reader__header-left,
.reader__header-right {
  display: flex;
  align-items: center;
  gap: 10px;
}
.reader__header-center {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
}
.reader__book {
  font-family: 'Playfair Display', serif;
  font-weight: 700;
  letter-spacing: 0.02em;
}
.reader__page {
  font-size: 12px;
  color: var(--reader-muted);
}
.reader__icon {
  all: unset;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  border-radius: 18px;
  border: 1px solid transparent;
  cursor: pointer;
  transition: background-color var(--reader-transition), border-color var(--reader-transition), color var(--reader-transition);
}
.reader__icon svg { display: block; }
.reader__icon.is-on {
  color: var(--reader-accent);
}
.reader__icon:focus-visible {
  outline: 3px solid var(--reader-accent);
  outline-offset: 3px;
}
.reader__sep {
  opacity: 0.4;
  font-weight: 700;
  letter-spacing: 0.08em;
}
.reader__pill {
  all: unset;
  cursor: pointer;
  font-weight: 700;
  padding: 4px 10px;
  border-radius: 999px;
  background: var(--reader-surface);
  border: 1px solid var(--reader-border);
  color: inherit;
  transition: background-color var(--reader-transition), color var(--reader-transition), border-color var(--reader-transition);
}
.reader__pill.is-active,
.reader__pill--accent {
  background: var(--reader-accent);
  color: #111;
  border-color: transparent;
}
.reader__pill:focus-visible {
  outline: 3px solid var(--reader-accent);
  outline-offset: 2px;
}
.reader__stage {
  position: relative;
  flex: 1 1 auto;
  overflow: hidden;
}

.reader-page {
  position: absolute;
  inset: 0;
  padding: clamp(20px, 6vw, 36px) clamp(18px, 6vw, 32px) clamp(28px, 12vw, 48px);
  display: flex;
  flex-direction: column;
  gap: clamp(14px, 3vw, 22px);
  touch-action: none;
  will-change: transform, opacity;
  transform: translate3d(0,0,0);
  opacity: 1;
  transition: transform calc(var(--reader-transition) * 1.1), opacity calc(var(--reader-transition) * 1.1);
}
.reader-page.page--enter.page--dir-next {
  transform: translate3d(24px, 0, 0);
  opacity: 0;
}
.reader-page.page--enter.page--dir-prev {
  transform: translate3d(-24px, 0, 0);
  opacity: 0;
}
.para {
  font-family: 'Libre Baskerville','Playfair Display',serif;
  font-size: calc(18px * var(--reader-font-scale, 1));
  line-height: 1.65;
}
.dlg {
  display: flex;
  align-items: baseline;
  gap: 8px;
}
.dlg--read {
  opacity: 0.66;
  filter: grayscale(0.12);
}

.music-rail,
.voice-rail {
  position: relative;
  width: 44px;
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  padding: 8px 0;
  border-radius: 22px;
  background: rgba(255,255,255,0.04);
  border: 1px solid var(--reader-border);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
  cursor: pointer;
  touch-action: none;
  user-select: none;
  color: var(--reader-muted);
  transition: background-color var(--reader-transition), border-color var(--reader-transition);
}
.reader[data-theme='light'] .music-rail,
.reader[data-theme='light'] .voice-rail {
  background: rgba(20,20,24,0.08);
}
.music-rail:focus-visible,
.voice-rail:focus-visible {
  outline: 3px solid var(--reader-accent);
  outline-offset: 3px;
}
.music-rail__icon,
.voice-rail__icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
}
.music-rail__track,
.voice-rail__track {
  position: relative;
  flex: 1 1 auto;
  width: 12px;
  border-radius: 10px;
  overflow: hidden;
  background: var(--reader-rail-track);
}
.music-rail__fill,
.voice-rail__fill {
  position: absolute;
  inset: 0;
  transform-origin: center bottom;
  background: var(--reader-rail-fill);
  will-change: transform;
  transition: transform calc(var(--reader-transition) * 0.6) ease;
}
.voice-rail__fill {
  background: var(--reader-voice-fill);
}

.reader__theme {
  width: 40px;
  height: 40px;
  border-radius: 20px;
  border: 1px solid var(--reader-border);
  background: var(--reader-surface);
  color: inherit;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: background-color var(--reader-transition), border-color var(--reader-transition), color var(--reader-transition);
}
.reader__theme:focus-visible {
  outline: 3px solid var(--reader-accent);
  outline-offset: 3px;
}

.reader__overlay {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  padding: max(12px, env(safe-area-inset-top)) max(12px, env(safe-area-inset-right)) max(20px, env(safe-area-inset-bottom)) max(12px, env(safe-area-inset-left));
  background: linear-gradient(180deg, rgba(0,0,0,0.45) 0%, rgba(0,0,0,0.05) 45%, rgba(0,0,0,0.55) 100%);
}
.reader__overlay-surface {
  width: min(680px, 100%);
  display: flex;
  flex-direction: column;
  gap: var(--reader-overlay-gap);
  padding: clamp(16px, 5vw, 28px) var(--reader-overlay-spacing) clamp(18px, 7vw, 36px);
  border-radius: var(--reader-panel-radius) var(--reader-panel-radius) 22px 22px;
  background: var(--reader-surface);
  border: 1px solid var(--reader-border);
  box-shadow: var(--reader-shadow);
}
@supports (backdrop-filter: blur(18px)) {
  .reader__overlay-surface {
    backdrop-filter: blur(18px) saturate(120%);
    background: rgba(18,18,25,0.7);
  }
  .reader[data-theme='light'] .reader__overlay-surface {
    background: rgba(255,255,245,0.88);
  }
}

.reader__overlay-topbar {
  display: flex;
  align-items: center;
  gap: 16px;
  flex-wrap: wrap;
}
.reader__overlay-heading {
  font-size: 13px;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--reader-muted);
}
.reader__overlay-actions {
  margin-left: auto;
  display: inline-flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}
.reader__overlay-tools {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}
.reader__overlay-close {
  all: unset;
  width: 36px;
  height: 36px;
  border-radius: 18px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.22);
  color: #fff;
  cursor: pointer;
  transition: background-color var(--reader-transition);
}
.reader[data-theme='light'] .reader__overlay-close {
  background: rgba(17,17,17,0.18);
}
.reader__overlay-close:focus-visible {
  outline: 3px solid var(--reader-accent);
  outline-offset: 3px;
}

.reader__overlay-rails {
  display: flex;
  justify-content: flex-end;
  align-items: flex-end;
  gap: clamp(12px, 5vw, 28px);
}
.reader__overlay-rails > * {
  pointer-events: auto;
}

.reader__carousel {
  display: flex;
  gap: 12px;
  overflow-x: auto;
  padding: 4px 0;
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
}
.reader__thumb {
  min-width: 160px;
  border-radius: 14px;
  background: var(--reader-panel-bg);
  color: inherit;
  overflow: hidden;
  position: relative;
  scroll-snap-align: center;
  border: 1px solid var(--reader-border);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04);
}
.reader__thumb-img {
  height: 88px;
  background: url('https://picsum.photos/320/180?blur=1') center/cover no-repeat;
}
.reader__thumb-meta {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 10px;
  font-size: 12px;
  gap: 6px;
}
.reader__thumb-badge {
  display: inline-grid;
  place-items: center;
  width: 24px;
  height: 24px;
  border-radius: 12px;
  background: var(--reader-accent);
  color: #111;
  font-weight: 700;
}

.reader__dock {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: clamp(10px, 4vw, 20px);
  padding: 12px clamp(12px, 6vw, 28px);
  border-radius: 999px;
  background: var(--reader-panel-bg);
  border: 1px solid var(--reader-border);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04);
}
.reader__dock-ind {
  display: inline-grid;
  place-items: center;
  min-width: 32px;
  height: 32px;
  border-radius: 16px;
  background: rgba(0,0,0,0.24);
  color: var(--reader-accent);
  font-weight: 800;
  font-size: 13px;
  padding: 0 10px;
}
.reader[data-theme='light'] .reader__dock-ind {
  background: rgba(17,17,17,0.12);
}
.reader__dock-btn {
  all: unset;
  cursor: pointer;
  font-weight: 800;
  letter-spacing: 0.08em;
  padding: 8px 16px;
  border-radius: 999px;
  background: rgba(0,0,0,0.24);
  color: inherit;
  border: 1px solid transparent;
  transition: background-color var(--reader-transition), color var(--reader-transition), border-color var(--reader-transition);
}
.reader[data-theme='light'] .reader__dock-btn {
  background: rgba(17,17,17,0.12);
}
.reader__dock-btn.is-active,
.reader__dock-btn:focus-visible {
  background: var(--reader-accent);
  color: #111;
  border-color: transparent;
}
.reader__dock-home {
  all: unset;
  width: 40px;
  height: 40px;
  border-radius: 20px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.28);
  color: #fff;
  cursor: pointer;
  transition: background-color var(--reader-transition);
}
.reader[data-theme='light'] .reader__dock-home {
  background: rgba(17,17,17,0.16);
}
.reader__dock-home:focus-visible {
  outline: 3px solid var(--reader-accent);
  outline-offset: 3px;
}

.reader__panel {
  margin-top: 8px;
  padding: 16px;
  border-radius: 20px;
  background: var(--reader-panel-bg);
  border: 1px solid var(--reader-border);
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.reader__panel-title {
  font-weight: 700;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  color: var(--reader-muted);
}
.reader__panel-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(44px, 1fr));
  gap: 8px;
}
.reader__cell {
  all: unset;
  display: grid;
  place-items: center;
  height: 44px;
  border-radius: 12px;
  background: rgba(0,0,0,0.24);
  color: inherit;
  font-weight: 600;
  cursor: pointer;
  transition: background-color var(--reader-transition), color var(--reader-transition);
}
.reader[data-theme='light'] .reader__cell {
  background: rgba(17,17,17,0.12);
}
.reader__cell.is-current {
  background: var(--reader-accent);
  color: #111;
}
.reader__panel-actions {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  justify-content: space-between;
}

@media (max-width: 768px) {
  .reader__overlay {
    align-items: stretch;
  }
  .reader__overlay-surface {
    width: 100%;
    border-radius: 24px 24px 18px 18px;
  }
  .reader__overlay-topbar {
    flex-direction: column;
    align-items: flex-start;
  }
  .reader__overlay-actions {
    margin-left: 0;
  }
  .reader__overlay-rails {
    justify-content: center;
  }
  .reader__dock {
    flex-wrap: wrap;
    justify-content: center;
  }
}

@media (prefers-reduced-motion: reduce) {
  .reader {
    --reader-transition: 1ms linear;
  }
  .reader-page {
    transition: none;
  }
  .music-rail__fill,
  .voice-rail__fill {
    transition: none;
  }
}

.reader__audio-prompt {
  position: absolute;
  left: 50%;
  top: 12px;
  transform: translateX(-50%);
  background: var(--reader-surface);
  color: inherit;
  padding: 10px 14px;
  border-radius: 12px;
  border: 1px solid var(--reader-border);
  box-shadow: var(--reader-shadow);
  z-index: 10060;
  font-weight: 700;
  letter-spacing: 0.02em;
  cursor: pointer;
}
.reader__audio-prompt:focus-visible {
  outline: 3px solid var(--reader-accent);
  outline-offset: 2px;
}

/* Skeleton states for loading tales */
.card--skeleton .card__media { background: #3b3b3b !important; filter: saturate(0.6) brightness(0.9); }
.card--skeleton .card__overlay { opacity: 0.4; }
.card--skeleton .card__label { color: transparent !important; background: linear-gradient(90deg, rgba(255,255,255,0.08), rgba(255,255,255,0.18), rgba(255,255,255,0.08)); background-size: 200% 100%; animation: shimmer 1.2s ease-in-out infinite; border-radius: 6px; min-height: 1.8rem; }
.card--skeleton .card__badge { background: #666 !important; color: transparent !important; box-shadow: none !important; border: none !important; }
@keyframes shimmer { 0% { background-position: 0% 0; } 100% { background-position: 200% 0; } }

/* Extra-wide screens: 4 columns gallery */
@media (min-width: 1536px) {
  .gallery { grid-template-columns: repeat(4, minmax(0, 1fr)); width: min(1480px, 90vw); }
}

/* =============================
   Gate Centering Overrides (final)
   Ensure strict horizontal centering on all devices
   ============================= */
.gate__hit { transform: none !important; }
.gate__msg {
  position: static !important;
  left: auto !important; top: auto !important; transform: none !important;
  margin-left: auto !important; margin-right: auto !important;
  text-align: center !important;
  max-width: min(90vw, 640px) !important;
}
.gate__logo {
  position: static !important;
  left: auto !important; top: auto !important; transform: none !important;
  display: block !important;
  margin-left: auto !important; margin-right: auto !important;
  transform-origin: 50% 50% !important;
  width: clamp(140px, min(52vw, 36vh), 360px) !important;
  max-width: min(380px, calc(100vw - 48px)) !important;
  max-height: min(44vh, 44dvh) !important;
}
.gate.is-starting .gate__msg { transform: none !important; }
.gate.is-finishing .gate__logo { transform: scale(1.03) !important; }

/* Re-declare keyframes to remove any residual translate from earlier blocks */
@keyframes gate-zoom {
  0% { transform: scale(0.98); }
  100% { transform: scale(1.02); }
}
/* Replace dialogue icon text with inline SVG via background */
.dlg__icon { 
  display: inline-block; width: 18px; height: 18px; vertical-align: -2px; 
  background: no-repeat center/contain url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%23fefff4' d='M12 3a9 9 0 100 18 9 9 0 000-18zm1 13h-2v-2h2v2zm0-4h-2V6h2v6z'/></svg>");
  /* hide any fallback text like '??' */
  font-size: 0; color: transparent; overflow: hidden;
}




